    mailout/app/README.md

Скрипт запуска рассылки
=======================

В этом каталоге находится `mailout.php`, главный скрипт, который запускает 
рассылку.
Он снабжён shebang'ом, так что может запускаться самостоятельно.

Запуск рассылки
---------------

Если текущий рабочий каталог --- `mailout/app/`, то команда на запуск рассылки 
выглядит так:
    
    ./mailout.php

или так:

    php mailout.php

Перед запуском рассылки нужно запуском скрипта `mailout/code/recipur.php` 
очистить статистику, сохранившуюся с предыдущей рассылки 
(см. `mailout/code/README.md`).
Очистка статистики важна тем, что она фиксирует получателей, отказавшихся от
рассылки.

Адреса рассылки
---------------

По умолчанию скрипт делает рассылку по всем адресам, сохранённым 
в SQLite базе в файле `mailout/code/recipients.db` 
(см. `mailout/code/README.md`).
Адреса, имеющие значение `1` в поле `ignore`, пропускаются. Считается, что это
получатели, отписавшиеся в предыдущей рассылке.

Если передать скрипту дополнительный аргумент `test`, то есть, вызвать
    
    ./mailout.php test

то будет запущена рассылка по адресам, имеющим `GID = 666`, этот `GID` выделен
на тестовые адреса.
Предполагается, что перед реальной рассылкой следует выполнить тестовый запуск
и убедиться, что письмо формируется верно.

Для того, чтобы сделать рассылку по адресам, имеющим определённый `GID`, 
на настоящий момент нужно поменять определение функции `get_addresses()` 
в `mailout.php`. 
Класс `RecipientsDB` уже содержит в себе метод `getEmailsByGID()`.

Смена шаблона письма
--------------------

Для генерации текста письма используется скрипт `mail-template.php`. 

`mailout.php` ожидает, что скрипт генерации текста определит переменную 
`$mail_text` в глобальном контексте. 

Маркер `######` в тексте письма будет заменён на ID получателя.

Проверьте, что теги изображений в HTML-письмах ссылаются на какой-нибудь реальный URL на сайте! Например:

    <img src="http://myaddress.dom/mailout/app/images/demo.jpg" />



